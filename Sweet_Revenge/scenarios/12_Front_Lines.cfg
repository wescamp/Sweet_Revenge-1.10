#textdomain wesnoth-SR
[scenario]
    id=12_Front_Lines
    name= _ "Front Lines"
    map_data="{~add-ons/Sweet_Revenge/maps/12_Front_Lines.map}"
    victory_when_enemies_defeated=no
    next_scenario=13a_Second_Thoughts ##Default for :debug users
    turns=32

    {DAWN}
    [+time]
	red,green,blue=-25,-25,-25
    [/time]
    {MORNING}
    {AFTERNOON}
    [+time]
	red,green,blue=-25,-25,-25
    [/time]
    {DUSK}
    [+time]
	red,green,blue=-50,-50,-50
    [/time]
    {FIRST_WATCH}
    [+time]
	red,green,blue=-75,-75,-75
    [/time]
    {SECOND_WATCH}
    [+time]
	red,green,blue=-100,-100,-100
    [/time]

    {DEFAULT_MUSIC_PLAYLIST}

    {STORY12}

    {CHECK_VERSION}

    {SHOVING (id=Hulk) (id=Rheoran)}

    {SR_DEATHS_LATE}

    [side]
        side=1
        controller=human

        type=bkAssassin
        id=Rheoran
        name= _ "Rheoran"
        canrecruit=yes
	gold=0
	income=-2
	team_name=good

        share_maps=yes
        share_view=yes

	user_team_name= _ "Avengers"
	recruit=""
	fog=yes
    [/side]
    [side]
        side=2
        controller=ai

        type=Necromancer
        id=Mal Korvan
        name= _ "Mal-Korvan"
        canrecruit=yes
	{GOLD 225 250 275}
	income=12
	{FLAG_VARIANT undead}
	team_name=undead
	user_team_name= _ "Undead"
#ifdef EASY
        recruit=Ghost,Skeleton,Skeleton Archer
#endif
#ifdef NORMAL
        recruit=Ghost,Skeleton,Skeleton Archer,Ghoul
#endif
#ifdef HARD
        recruit=Ghost,Skeleton,Skeleton Archer,Ghoul,Shadow
#endif
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT simple_targeting yes}
#ifdef EASY
        {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "scout,fighter,archer"}
#endif
#ifdef NORMAL
        {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "scout,fighter,fighter,archer"}
#endif
#ifdef HARD
        {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "fighter,scout,archer,fighter"}
#endif
            {ATTACK_DEPTH 4 5 6}
            {AI_SIMPLE_ALWAYS_ASPECT grouping offensive}
            [target]
                id=Aethuc
                value=100
            [/target]
            [target]
                id=Rheoran
                value=0
            [/target]
            [target]
                id=Bledoc
                value=0
            [/target]
	[/ai]
        [ai]
            time_of_day=dusk
            aggression=0.7
            caution=0.25
        [/ai]
        [ai]
            time_of_day=first_watch,second_watch
            aggression=1.0
            caution=0.0
        [/ai]
    [/side]
    [side]
        side=3
        controller=ai
	{FLAG_VARIANT loyalist}
        type=EOM_Sentinel
        id=Aethuc #providing some continuity
        name= _ "Aethuc"
        canrecruit=yes
	{GOLD 200 225 250}
	income=12

        share_maps=no
        share_view=no

#ifdef EASY
        recruit=EOM_Legionnaire,EOM_Crusader,EOM_Zealot
#endif
#ifdef NORMAL
        recruit=EOM_Legionnaire,EOM_Crusader,EOM_Zealot,Bowman
#endif
#ifdef HARD
        recruit=EOM_Legionnaire,EOM_Crusader,EOM_Zealot,Bowman,Spearman
#endif
	team_name=revivers
	user_team_name= _ "Revivers"
        {ai/aliases/stable_singleplayer.cfg}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT passive_leader yes}
            {AI_SIMPLE_ALWAYS_ASPECT simple_targeting yes}
#ifdef EASY
        {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "mixed fighter,fighter,mixed fighter,archer"}
#endif
#ifdef NORMAL
        {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "mixed fighter,archer,mixed fighter,fighter,archer"}
#endif
#ifdef HARD
        {AI_SIMPLE_ALWAYS_ASPECT recruitment_pattern "mixed fighter,fighter,mixed fighter,archer,fighter"}
#endif
            {ATTACK_DEPTH 4 5 6}
            {AI_SIMPLE_ALWAYS_ASPECT grouping offensive}
            [target]
                id=Mal Korvan
                value=100
            [/target]
            [target]
                id=Rheoran
                value=75
            [/target]
            [target]
                id=Hulk
                value=75
            [/target]
	[/ai]
        [ai]
            time_of_day=dawn
            aggression=0.7
            caution=0.25
        [/ai]
        [ai]
            time_of_day=morning,afternoon
            aggression=1.0
            caution=0.0
        [/ai]
    [/side]
    [side]
	side=4

	controller=ai
	no_leader=yes
	fog=yes

	team_name=good
	user_team_name= _ "Outlaws"

        share_maps=yes
        share_view=yes

        {ai/aliases/stable_singleplayer.cfg}
	[ai]
            {AI_SIMPLE_ALWAYS_ASPECT simple_targeting yes}
	    [goal]
		name=target_location
		[criteria]
		    x,y=23-37,47
		[/criteria]
		value=50
	    [/goal]
            [target]
                id=Rheoran
                value=150
            [/target]
	[/ai]
    [/side]
	    #define SPAWN_GHOSTS
		{VARIABLE seen 1}
		[store_unit]
		    [filter]
			id=Mal Korvan
		    [/filter]
		    kill=no
		    variable=leader2
		[/store_unit]
		[store_unit]
		    [filter]
			id=Aethuc
		    [/filter]
		    kill=no
		    variable=leader3
		[/store_unit]
		[unit]
		    side=2
		    type=bkGhost
		    name= _ "Mal-Korvan"
		    id=side2_ghost
		    to_variable=ghost1
		[/unit]
		[unit]
		    side=3
		    type=bkGhost
		    name= _ "Aethuc"
		    id=side3_ghost
		    to_variable=ghost2
		[/unit]
		[unstore_unit]
		    variable=ghost1
		    x,y=$leader2.x,$leader2.y
		    find_vacant=yes
		[/unstore_unit]
		[unstore_unit]
		    variable=ghost2
		    x,y=$leader3.x,$leader3.y
		    find_vacant=yes
		[/unstore_unit]
		[if]
		    [variable]
			name=side2.team_name
			equals=good
		    [/variable]
		    [then]
			{MODIFY_UNIT (id=side2_ghost) side 1}
			[scroll_to_unit]
			    id=side2_ghost
			[/scroll_to_unit]
			[delay]
			    time=750
			[/delay]
		    [/then]
		    [else]
			{MODIFY_UNIT (id=side3_ghost) side 1}
			[scroll_to_unit]
			    id=side3_ghost
			[/scroll_to_unit]
			[delay]
			    time=750
			[/delay]
		    [/else]
		[/if]
		{MODIFY_UNIT (id=Rheoran) status.slowed yes}
		{MODIFY_UNIT (id=Hulk) status.slowed yes}
	    #enddef
    [event]
	name=prestart
	[disallow_recruit]
	    side=1
	    type=Thug,Poacher,Footpad,Thief
	[/disallow_recruit]
	[unit]
	    side=1
	    type=Bandit
	    name= _ "The Hulk" #Why not? I've referenced all the other movies.
	    random_traits=yes
	    x,y=29,1
	    id=Hulk
	    {IS_HERO}
	[/unit]
	[unit]
	    side=1
	    type=Footpad
	    id=Guard
	    generate_name=yes
	    random_traits=yes
	    x,y=28,1
	[/unit]
	[unit]
	    side=1
	    type=Poacher
	    generate_name=yes
	    random_traits=yes
	    id=Guard2
	    x,y=28,2
	[/unit]
	[unit]
	    side=1
	    type=Outlaw
	    generate_name=yes
	    random_traits=yes
	    x,y=30,1
	    id=Guard3
	[/unit]
	[unit]
	    side=1
	    type=Trapper
	    generate_name=yes
	    random_traits=yes
	    x,y=30,2
	[/unit]
	[unit]
	    side=1
	    type={DIFF (Bandit) (Bandit) (Thug)}
	    generate_name=yes
	    random_traits=yes
	    x,y=28,3
	[/unit]
	[unit]
	    side=1
	    type={DIFF (Poacher) (Poacher) (Trapper)}
	    generate_name=yes
	    random_traits=yes
	    x,y=28,5
	[/unit]
    [/event]
    [event]
	name=start
	{MODIFY_UNIT (id=Rheoran) moves 0}
	{MODIFY_UNIT (id=Rheoran) max_moves 0}
	[message]
	    speaker=Rheoran
	    message= _ "I'm not going! You'll never budge me!"
	[/message]
	[message]
	    speaker=Guard
	    message= _ "(sigh) Hulk!"
	[/message]
	{MOVE_UNIT (id=Hulk) 29 2}
	[message]
	    speaker=Hulk
	    message= _ "Ugh..."
	[/message]
	[animate_unit]
	    flag=attack
	    [filter]
		id=Hulk
	    [/filter]
	    [facing]
		[filter]
		    id=Rheoran
		[/filter]
	    [/facing]
	    [filter_second]
		id=Rheoran
	    [/filter_second]
	    [primary_attack]
		range=melee
	    [/primary_attack]
	    hits=yes
	[/animate_unit]
	[message]
	    speaker=Rheoran
	    message= _ "Owch!"
	[/message]
	{MOVE_UNIT (id=Rheoran) 29 6}
	[message]
	    speaker=Guard
	    message= _ "E's been goin' on like this fer hours! Can't we jist dump 'im?" # wmllint: no spellcheck
	[/message]
	[message]
	    speaker=Guard2
	    message= _ "No! The Boss will have our heads for sure. Though we could make it look like an accident..."
	[/message]
	[message]
	    speaker=Hulk
	    message= _ "Me like little squeaky man."
	[/message]
	[message]
	    speaker=Guard3
	    message= _ "Shove a sock in it, Hulk. You don't know anything."
	[/message]
	[message]
	    speaker=Guard2
	    message= _ "I feel uneasy about this place. This fog isn't natural. We should hurry through this as fast as possible. Hulk, 'help' our little daddy's boy here get along."
	[/message]
	[objectives]
	    side=1
	    [objective]
		description= _ "Make your way to the southern road"
		condition=win
	    [/objective]
	    [objective]
		description= _ "NOTE: Right-click on Rheoran when the Hulk is near and choose the 'Shove' option to 'help' Rheoran get moving."
		condition=win
	    [/objective]
	    [objective]
		description= _ "Death of Rheoran"
		condition=lose
	    [/objective]
	    [objective]
		description= _ "Death of the Hulk"
		condition=lose
	    [/objective]
	[/objectives]
    [/event]
    [event]
	name=turn 4
	[message]
	    speaker=Hulk
	    message= _ "Ugh."
	[/message]
	[message]
	    speaker=Rheoran
	    message= _ "What is this darkness!?!"
	[/message]
	[role]
	    role=smart_aleck
	    type=Thug,Poacher,Footpad,Outlaw,Trapper
	[/role]
	[message]
	    role=smart_aleck
	    message= _ "I <i>told</i> you that this place wasn't natural."
	[/message]
    [/event]
    {ON_SIGHTING (Revivers) (1) (side=3) (
	[scroll_to_unit]
	    id=$second_unit.id
	[/scroll_to_unit]
	[if]
	    [variable]
		name=unit.id
		not_equals="Hulk"
	    [/variable]
	    [then]
		[message]
		    speaker=$unit.id
		    message= _ "They're here?! This far east!?"
		[/message]
	    [/then]
	    [else]
		[message]
		    speaker=Hulk
		    message= _ "Shiny armour...!"
		[/message]
	    [/else]
	[/if]
	[message]
	    speaker=Guard
	    message= _ "We're too late! What can we do!?"
	[/message]
	[message]
	    speaker=Rheoran
	    message= _ "Who are these people anyway?"
	[/message]
	{VARIABLE_OP sightings add 1}
	[if]
	    [variable]
		name=sightings
		equals=2
	    [/variable]
	    [then]
		[fire_event]
		    name=crossfire
		[/fire_event]
	    [/then]
	[/if]
    )}
    {ON_SIGHTING (Undead) (1) (side=2) (
	[scroll_to_unit]
	    id=$second_unit.id
	[/scroll_to_unit]
	[if]
	    [variable]
		name=unit.id
		not_equals="Hulk"
	    [/variable]
	    [then]
		[message]
		    speaker=$unit.id
		    message= _ "Gah! Undead!"
		[/message]
	    [/then]
	    [else]
		[message]
		    speaker=Hulk
		    message= _ "Dead people!"
		[/message]
	    [/else]
	[/if]
	[message]
	    speaker=Rheoran
	    message= _ "Have they made it this far? It makes me shudder to think of the villages they must have gone through on their way..."
	[/message]
	{VARIABLE_OP sightings add 1}
	[if]
	    [variable]
		name=sightings
		equals=2
	    [/variable]
	    [then]
		[fire_event]
		    name=crossfire
		[/fire_event]
	    [/then]
	[/if]
    )}
    [event]
	name=crossfire
	[role]
	    type=Thug,Poacher,Trapper,Footpad,Outlaw
	    role=scared
	[/role]
	[message]
	    role=scared
	    message= _ "They're closing in on us! We can't escape from two battling armies!"
	[/message]
	[message]
	    speaker=Rheoran
	    message= _ "We must join with one of them!"
	[/message]
	[message]
	    role=scared
	    message= _ "I'm afraid I can't let you do that. For all purposes you must remain our prisoner. Come, we must hurry to the southern road!"
	[/message]
	[message]
	    speaker=Rheoran
	    message= _ {ASIDE (I can't stay with these outlaws, I'll be slaughtered... I must make a choice. Which one will I most likely survive?  )}
	[/message]
	[message]
	    speaker=Hulk
	    message= _ {ASIDE (Me come with you. Me like little man.  )}
	[/message]
	{NARRATOR_MESSAGE (_"<i>Join us, Rheoran...</i>")}
	[message]
	    speaker=Rheoran
	    message= _ "Who's there?"
	[/message]
	{NARRATOR_MESSAGE (_"<b><i>You can gain limitless power... Enough to avenge your true father...</i></b>")}
	{FLASH_WHITE ()}
	{NARRATOR_MESSAGE (_"<big>SILENCE!!</big>")}
	{NARRATOR_MESSAGE (_"Do not listen to them, Rheoran. Their deceptions lead only to death or undeath. Join our noble cause for redeeming light!")}
	[message]
	    speaker=narrator
	    image="wesnoth-icon.png"
	    message= _ "Who will you join?"
	    [option]
		message= _ "The Undead. The ones with the most power survive longest!"
		image="units/undead/skeleton.png"
		[command]
		    [message]
			speaker=Rheoran
			message= _ "I will join the undead. I have no other way to survive this."
		    [/message]
		    {NARRATOR_MESSAGE (_"And to gain your desires...")}
		    [message]
			speaker=Rheoran
			message= _ "Come Hulk, let's leave before the guards notice!"
		    [/message]
		    [modify_side]
			side=2
			team_name=good
		    [/modify_side]
		    [store_side]
			side=2
			variable=side2
		    [/store_side]
		    [store_side]
			side=3
			variable=side3
		    [/store_side]
		    {MODIFY_UNIT (id=Rheoran) max_moves 6}
		    {MODIFY_UNIT (id=Rheoran) moves 6}
		    [objectives]
			side=1
			[objective]
			    description= _ "Go to the extra keep of the Undead"
			    condition=win
			[/objective]
			[objective]
			    description= _ "Death of Rheoran"
			    condition=lose
			[/objective]
			[objective]
			    description= _ "Death of the Hulk"
			    condition=lose
			[/objective]
		    [/objectives]
		[/command]
	    [/option]
	    [option]
		message= _ "The Revivers. Wesnoth must be redeemed from its reign of tyranny!"
		image="units/divine-champion.png"
		[command]
		    [message]
			speaker=Rheoran
			message= _ "I will join the Revivers. I must end this evil that I have helped to bring out."
		    [/message]
		    {NARRATOR_MESSAGE (_"You have made the right choice, Rheoran...")}
		    [message]
			speaker=Rheoran
			message= _ "Come Hulk, let's leave before the guards notice!"
		    [/message]
		    [modify_side]
			side=3
			team_name=good
		    [/modify_side]
		    [store_side]
			side=2
			variable=side2
		    [/store_side]
		    [store_side]
			side=3
			variable=side3
		    [/store_side]
		    {MODIFY_UNIT (id=Rheoran) max_moves 6}
		    {MODIFY_UNIT (id=Rheoran) moves 6}
		    [objectives]
			side=1
			[objective]
			    description= _ "Go to the extra keep of the Revivers"
			    condition=win
			[/objective]
			[objective]
			    description= _ "Death of Rheoran"
			    condition=lose
			[/objective]
			[objective]
			    description= _ "Death of the Hulk"
			    condition=lose
			[/objective]
		    [/objectives]
		[/command]
	    [/option]
	[/message]
	{VARIABLE run_start $turn_number}
	{VARIABLE_OP run_start add ({DIFF 3 2 2})}
	{MODIFY_UNIT (
	    side=1
	    [not]
		id=Rheoran,Hulk
	    [/not]
	    ) side 4
	}
    [/event]
    [event]
	name=side 2 turn
	first_time_only=no
	[modify_side]
	    side=4
	    team_name="bad"
	[/modify_side]
    [/event]
    [event]
	name=side 2 turn end
	first_time_only=no
	[if]
	    [variable]
		name=outlaws_bad
		not_equals=1
	    [/variable]
	    [then]
		[modify_side]
		    side=4
		    team_name="good"
		[/modify_side]
	    [/then]
	[/if]
    [/event]
    [event]
	name=side 3 turn
	first_time_only=no
	[modify_side]
	    side=4
	    team_name="bad"
	[/modify_side]
    [/event]
    [event]
	name=side 3 turn end
	first_time_only=no
	[if]
	    [variable]
		name=outlaws_bad
		not_equals=1
	    [/variable]
	    [then]
		[modify_side]
		    side=4
		    team_name="good"
		[/modify_side]
	    [/then]
	[/if]
    [/event]
    [event]
	name=new turn
	first_time_only=no
	[if]
	    [variable]
		name=turn_number
		equals=$run_start
	    [/variable]
	    [then]
		[role]
		    role=suspicious
		    type=Trapper,Outlaw,Footpad,Thug,Poacher
		[/role]
		[message]
		    role=suspicious
		    message= _ "'Ey, where you be goin'?"
		[/message]
		[message]
		    speaker=Hulk
		    message= _ "Err.. we go escape!"
		[/message]
		[message]
		    speaker=Rheoran
		    message= _ "<small>Quiet, Hulk!</small>"
		[/message]
		[message]
		    role=suspicious
		    message= _ "'Ey, they're gettin' away! Get 'em!"
		[/message]
		[message]
		    speaker=Hulk
		    message= _ "Me sorry."
		[/message]
		[modify_side]
		    side=4
		    team_name=bad
		[/modify_side]
		{VARIABLE outlaws_bad 1}
		[if]
		    [variable]
			name=side2.team_name
			equals="bad"
		    [/variable]
		    [then]
			{RESPAWN_EVENT (Ghost) 2 29 1 (yes) 3}
		    [/then]
		    [else]
			{RESPAWN_EVENT (EOM_Zealot) 3 29 1 (yes) 3}
		    [/else]
		[/if]
	    [/then]
	[/if]
    [/event]
    [event]
	name=turn 10
	[if]
	    [variable]
		name=side2.team_name
		not_equals="good"
	    [/variable]
	    [then]
		{GIVE_GOLD 2 500 500 500}
		{GIVE_GOLD 3 300 300 300}
	    [/then]
	    [else]
		{GIVE_GOLD 2 400 400 400}
		{GIVE_GOLD 3 400 400 400}
	    [/else]
	[/if]
	{CLEAR_VARIABLE undead}
    [/event]
    [event]
	name=moveto
	[filter]
	    id=Rheoran
	    x,y=53,24
	[/filter]
	{NARRATOR_MESSAGE (_"Good, you made it.")}
	[message]
	    speaker=Rheoran
	    message= _ "Could you perhaps talk normally?"
	[/message]
	[delay]
	    time=750
	[/delay]
	[message]
	    speaker=Rheoran
	    message= _ "I suppose not. But before we leave, why are you heading west?"
	[/message]
	{NARRATOR_MESSAGE (_"To subdue the fortress of Dan'Tonk...")}
	{CLEAR_FOG 1 28 6 1}
	[unit]
	    side=1
	    type=Cavalryman
	    id=Messenger
	    x,y=28,7
	[/unit]
	[message]
	    speaker=Messenger
	    message= _ "What's this? A battle?"
	[/message]
	{MOVE_UNIT (id=Messenger) 28 16}
	{CLEAR_FOG 1 27 16 1}
	{NARRATOR_MESSAGE (_"Good messenger, what news do you bring?")}
	[message]
	    speaker=Messenger
	    message= _ "What? Who said that?"
	[/message]
	{NARRATOR_MESSAGE (_"No concern of yours. Now, <big>what news do you bring?</big>")}
	[message]
	    speaker=Messenger
	    message= _ "The outlaws have subdued Dan'Tonk! It is no more!"
	[/message]
	{NARRATOR_MESSAGE (_"<big>NO!</big> It cannot be! How have they gained the power to do this?")}
	[message]
	    speaker=Messenger
	    message= _ "W-wait a second! Y-you're a necromancer! An undead invasion! I must warn the capital!"
	[/message]
	{NARRATOR_MESSAGE (_"<small><i>Occus cremaus incantes mortes!</i></small>")}
	[message]
	    speaker=Messenger
	    message= _ "Ugh!"
	[/message]
	[kill]
	id=Messenger
	animate=yes
	[/kill]
	{UNCLEAR_FOG}
	[message]
	    speaker=Rheoran
	    message= _ "How terrible! I suppose it had to be done, though..."
	[/message]
	{NARRATOR_MESSAGE (_"It did. We must make it to Weldyn. Go to the edge of the southern road; your path will be hidden in darkness.")}
	[message]
	    speaker=Rheoran
	    message= _ "How will we get through?"
	[/message]
	{NARRATOR_MESSAGE (_"Rheoran hears what almost sounds like a snigger, but obviously such a sound could not be coming from a necromancer.")}
	{FADE_TO_BLACK}
	{MODIFY_UNIT (id=Rheoran) variables.running_revivers yes}
	{MODIFY_UNIT (id=Hulk) variables.running_revivers yes}
        [object]
            silent=yes
            [filter]
                id=Rheoran
            [/filter]
            [effect]
                apply_to=new_animation
                [standing_anim]
                    [filter]
                        type=bkAssassin
                        [filter_wml]
                            [variables]
                                running_revivers=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/white_assassin.png"
                    [/frame]
                [/standing_anim]
                [movement_anim]
                    [filter]
                        type=bkAssassin
                        [filter_wml]
                            [variables]
                                running_revivers=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/white_assassin.png"
                    [/frame]
                [/movement_anim]
                [idle_anim]
                    [filter]
                        type=bkAssassin
                        [filter_wml]
                            [variables]
                                running_revivers=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/white_assassin.png"
                    [/frame]
                [/idle_anim]
	    [/effect]
	[/object]
	[object]
	    silent=yes
	    [filter]
		id=Hulk
	    [/filter]
	    [effect]
		apply_to=new_animation
                [standing_anim]
                    [filter]
                        type=Bandit
                        [filter_wml]
                            [variables]
                                running_revivers=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/white_bandit.png"
                    [/frame]
                [/standing_anim]
                [movement_anim]
                    [filter]
                        type=Bandit
                        [filter_wml]
                            [variables]
                                running_revivers=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/white_bandit.png"
                    [/frame]
                [/movement_anim]
                [idle_anim]
                    [filter]
                        type=Bandit
                        [filter_wml]
                            [variables]
                                running_revivers=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/white_bandit.png"
                    [/frame]
                [/idle_anim]
            [/effect]
        [/object]
	[redraw]
	[/redraw]
	{FADE_IN}
	[message]
	    speaker=Rheoran
	    message= _ "...I look like an idiot."
	[/message]
	{NARRATOR_MESSAGE (_"I won't argue with that. However, this makeshift disguise should give you ample time to sneak through the lines, given that you don't run into one of the enemy.")}
	[objectives]
	    side=1
	    [objective]
		description= _ "Make your way to the southern road"
		condition=win
	    [/objective]
	    [objective]
		description= _ "Death of Rheoran"
		condition=lose
	    [/objective]
	    [objective]
		description= _ "Death of the Hulk"
		condition=lose
	    [/objective]
	[/objectives]
	{VARIABLE turn_count_start $turn_number}
	{VARIABLE_OP turn_count_start add ({DIFF 5 4 3})}
	{MODIFY_AI_ADD_GOAL 3 (
	    [target]
		id=Rheoran
		value=0
	    [/target]
	)}
	{MODIFY_AI_ADD_GOAL 3 (
	    [target]
		id=Hulk
		value=0
	    [/target]
	)}
	[event]
	    name=side 1 turn
	    first_time_only=no
	    {MODIFY_UNIT (side=1) attacks_left 0}
	[/event]
    [/event]
    [event]
	name=moveto
	[filter]
	    id=Rheoran
	    x,y=4,27
	[/filter]
	[message]
	    speaker=Aethuc
	    message= _ "Wonderful - you made it!"
	[/message]
	[message]
	    speaker=Rheoran
	    message= _ "Before we leave, why are you heading east? Who are you people?"
	[/message]
	[message]
	    speaker=Aethuc
	    message= _ "We are the Revivers, come to liberate the land of Wesnoth from its reign of tyranny! And we are heading east to reach Weldyn before reinforcements from Dan'Tonk can find us."
	[/message]
	{CLEAR_FOG 1 28 6 1}
	[unit]
	    side=1
	    type=Cavalryman
	    id=Messenger
	    x,y=28,7
	[/unit]
	[message]
	    speaker=Messenger
	    message= _ "What's this? A battle?"
	[/message]
	{MOVE_UNIT (id=Messenger) 28 16}
	{CLEAR_FOG 1 27 17 1}
	{NARRATOR_MESSAGE (_"Good messenger, what news do you bring?")}
	[message]
	    speaker=Messenger
	    message= _ "What? Who are you?"
	[/message]
	{NARRATOR_MESSAGE (_"I am your conscience.")}
	[message]
	    speaker=Aethuc
	    message= _ "(snicker) Never gets old."
	[/message]
	[message]
	    speaker=Messenger
	    message= _ "O-okay conscience. The outlaws have subdued Dan'Tonk! It is no more!"
	[/message]
	[message]
	    speaker=Aethuc
	    message= _ "No! It cannot be!"
	[/message]
	[message]
	    speaker=Messenger
	    message= _ "W-wait a second! Y-you're the revivers! And there are undead here! An invasion! I must warn the capital!"
	[/message]
	[message]
	    speaker=narrator
	    image="units/undead-necromancers/necromancer.png"
	    message= _ "<small><i>Occus cremaus incantes mortes!</i></small>"
	[/message]
	[message]
	    speaker=Messenger
	    message= _ "Ugh!"
	[/message]
	[kill]
	id=Messenger
	animate=yes
	[/kill]
	{UNCLEAR_FOG}
	[message]
	    speaker=Aethuc
	    message= _ "How terrible! What powers these creatures have acquired..."
	[/message]
	[message]
	    speaker=Aethuc
	    message= _ "You must make it to the southern road. We will deal these abominations."
	[/message]
	[message]
	    speaker=Rheoran
	    message= _ "How will we get through?"
	[/message]
	[message]
	    speaker=Aethuc
	    message= _ "I've always wanted to try this. Do you mind?"
	[/message]
	{FADE_TO_BLACK}
	{MODIFY_UNIT (id=Rheoran) variables.running_undead yes}
	{MODIFY_UNIT (id=Hulk) variables.running_undead yes}
        [object]
            silent=yes
            [filter]
                id=Rheoran
            [/filter]
            [effect]
                apply_to=new_animation
                [standing_anim]
                    [filter]
                        type=bkAssassin
                        [filter_wml]
                            [variables]
                                running_undead=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/assassin_robe.png"
                    [/frame]
                [/standing_anim]
                [movement_anim]
                    [filter]
                        type=bkAssassin
                        [filter_wml]
                            [variables]
                                running_undead=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/assassin_robe.png"
                    [/frame]
                [/movement_anim]
                [idle_anim]
                    [filter]
                        type=bkAssassin
                        [filter_wml]
                            [variables]
                                running_undead=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/assassin_robe.png"
                    [/frame]
                [/idle_anim]
	    [/effect]
	[/object]
	[object]
	    silent=yes
	    [filter]
		id=Hulk
	    [/filter]
	    [effect]
		apply_to=new_animation
                [standing_anim]
                    [filter]
                        type=Bandit
                        [filter_wml]
                            [variables]
                                running_undead=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/bandit_robe.png"
                    [/frame]
                [/standing_anim]
                [movement_anim]
                    [filter]
                        type=Bandit
                        [filter_wml]
                            [variables]
                                running_undead=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/bandit_robe.png"
                    [/frame]
                [/movement_anim]
                [idle_anim]
                    [filter]
                        type=Bandit
                        [filter_wml]
                            [variables]
                                running_undead=yes
                            [/variables]
                        [/filter_wml]
                    [/filter]
                    [frame]
                        duration=150
                        image="units/bandit_robe.png"
                    [/frame]
                [/idle_anim]
            [/effect]
        [/object]
	[redraw]
	[/redraw]
	{FADE_IN}
	[message]
	    speaker=Rheoran
	    message= _ "...I look like an idiot."
	[/message]
	[message]
	    speaker=Aethuc
	    message= _ "Last time I checked, ghosts don't look so nice either. As long as you don't get too close to one, I doubt that they'll notice the difference."
	[/message]
	[objectives]
	    side=1
	    [objective]
		description= _ "Make your way to the southern road"
		condition=win
	    [/objective]
	    [objective]
		description= _ "Death of Rheoran"
		condition=lose
	    [/objective]
	    [objective]
		description= _ "Death of the Hulk"
		condition=lose
	    [/objective]
	[/objectives]
	{VARIABLE turn_count_start $turn_number}
	{VARIABLE_OP turn_count_start add ({DIFF 5 4 3})}
	{MODIFY_AI_ADD_GOAL 2 (
	    [target]
		id=Rheoran
		value=0
	    [/target]
	)}
	{MODIFY_AI_ADD_GOAL 2 (
	    [target]
		id=Hulk
		value=0
	    [/target]
	)}
	[event]
	    name=side 1 turn
	    first_time_only=no
	    {MODIFY_UNIT (side=1) attacks_left 0}
	[/event]
    [/event]
    [event]
	name=attack
	[filter]
	    side=2,3
	[/filter]
	[filter_second]
	    id=Rheoran,Hulk
	[/filter_second]
	[if]
	    [variable]
		name=seen
		not_equals=1
	    [/variable]
	    [then]
		[if]
		    [variable]
			name=second_unit.variables.running_undead
			equals=yes
		    [/variable]
		    [then]
			[message]
			    speaker=$unit.id
			    message= _ "Blarghergen?" # wmllint: no spellcheck
			[/message]
			[message]
			    speaker=Mal Korvan
			    message= _ "I sense dissension within the ranks..."
			[/message]
			[message]
			    speaker=Hulk
			    message= _ "Ugh!"
			[/message]
			[message]
			    speaker=Rheoran
			    message= _ "Aethuc! I sense a dark presence penetrating my mind! I cannot resist much longer!"
			[/message]
			[message]
			    speaker=Aethuc
			    message= _ "I shall show this creature the power of the light!"
			[/message]
			[objectives]
			    side=1
			    [objective]
				description= _ "Destroy Mal Korvan with Aethuc's awareness"
				condition=win
			    [/objective]
			    [objective]
				description= _ "NOTE: You must hit Mal Korvan with one of the spirit's attacks to destroy him."
				condition=win
			    [/objective]
			    [objective]
				description= _ "Make your way to the southern road"
				condition=win
			    [/objective]
			    [objective]
				description= _ "Aethuc is destroyed by Mal Korvan's awareness"
				condition=lose
			    [/objective]
			    [objective]
				description= _ "Death of Rheoran"
				condition=lose
			    [/objective]
			    [objective]
				description= _ "Death of the Hulk"
				condition=lose
			    [/objective]
			[/objectives]
			{SPAWN_GHOSTS}
			[store_unit]
			    [filter]
				id=$unit.id
			    [/filter]
			    kill=no
			    variable=unit_att
			[/store_unit]
			{VARIABLE unit_att.attacks_left 0}
		    [/then]
		    [else]
			[if]
			    [variable]
				name=second_unit.variables.running_revivers
				equals=yes
			    [/variable]
			    [then]
				[message]
				    speaker=$unit.id
				    message= _ "You're not in uniform!"
				[/message]
				[message]
				    speaker=Aethuc
				    message= _ "I sense dissension within the ranks..."
				[/message]
				[message]
				    speaker=Hulk
				    message= _ "Ugh!"
				[/message]
				[message]
				    speaker=Rheoran
				    message= _ "Mal Korvan, something is attempting to penetrate my mind! I cannot resist much longer!"
				[/message]
				{NARRATOR_MESSAGE (_"I will show this pretender the true power of the Alliance!")}
				[objectives]
				    side=1
				    [objective]
					description= _ "Destroy Aethuc with Mal Korvan's awareness"
					condition=win
				    [/objective]
				    [objective]
					description= _ "NOTE: You must hit Aethuc with one of the spirit's attacks to destroy him."
					condition=win
				    [/objective]
				    [objective]
					description= _ "Make your way to the southern road"
					condition=win
				    [/objective]
				    [objective]
					description= _ "Mal Korvan is destroyed by Aethuc's awareness"
					condition=lose
				    [/objective]
				    [objective]
					description= _ "Death of Rheoran"
					condition=lose
				    [/objective]
				    [objective]
					description= _ "Death of the Hulk"
					condition=lose
				    [/objective]
				[/objectives]
				{SPAWN_GHOSTS}
				[store_unit]
				    [filter]
					id=$unit.id
				    [/filter]
				    kill=no
				    variable=unit_att
				[/store_unit]
				{VARIABLE unit_att.attacks_left 0}
			    [/then]
			[/if]
		    [/else]
		[/if]
	    [/then]
	[/if]
    [/event]
    [event]
	name=new turn
	first_time_only=no
	[if]
	    [variable]
		name=turn_number
		equals=$turn_count_start
	    [/variable]
	    [variable]
		name=seen
		not_equals=1
	    [/variable]
	    [then]
		[store_side]
		    side=2
		    variable=side2
		[/store_side]
			[if]
			    [variable]
				name=side2.team_name
				equals="good"
			    [/variable]
			    [then]
				[message]
				    speaker=Aethuc
				    message= _ "I sense dissension within the ranks..."
				[/message]
				[message]
				    speaker=Hulk
				    message= _ "Ugh!"
				[/message]
				[message]
				    speaker=Rheoran
				    message= _ "Mal Korvan, something is attempting to penetrate my mind! I cannot resist much longer!"
				[/message]
				{NARRATOR_MESSAGE (_"I will show this pretender the true power of the Alliance!")}
				[objectives]
				    side=1
				    [objective]
					description= _ "Destroy Aethuc with Mal Korvan's awareness"
					condition=win
				    [/objective]
				    [objective]
					description= _ "NOTE: You must hit Aethuc with one of the spirit's attacks to destroy him."
					condition=win
				    [/objective]
				    [objective]
					description= _ "Make your way to the southern road."
					condition=win
				    [/objective]
				    [objective]
					description= _ "Mal Korvan is destroyed by Aethuc's awareness"
					condition=lose
				    [/objective]
				    [objective]
					description= _ "Death of Rheoran"
					condition=lose
				    [/objective]
				    [objective]
					description= _ "Death of the Hulk"
					condition=lose
				    [/objective]
				[/objectives]
			    [/then]
			    [else]
				[message]
				    speaker=Mal Korvan
				    message= _ "I sense dissension within the ranks..."
				[/message]
				[message]
				    speaker=Hulk
				    message= _ "Ugh!"
				[/message]
				[message]
				    speaker=Rheoran
				    message= _ "Aethuc! I sense a dark presence penetrating my mind! I cannot resist much longer!"
				[/message]
				[message]
				    speaker=Aethuc
				    message= _ "I shall show this creature the power of the light!"
				[/message]
				[objectives]
				    side=1
				    [objective]
					description= _ "Destroy Mal Korvan with Aethuc's awareness"
					condition=win
				    [/objective]
				    [objective]
					description= _ "NOTE: You must hit Mal Korvan with one of the spirit's attacks to destroy him."
					condition=win
				    [/objective]
				    [objective]
					description= _ "Make your way to the southern road."
					condition=win
				    [/objective]
				    [objective]
					description= _ "Aethuc is destroyed by Mal Korvan's awareness"
					condition=lose
				    [/objective]
				    [objective]
					description= _ "Death of Rheoran"
					condition=lose
				    [/objective]
				    [objective]
					description= _ "Death of the Hulk"
					condition=lose
				    [/objective]
				[/objectives]
			    [/else]
			[/if]
		{SPAWN_GHOSTS}
	    [/then]
	[/if]
    [/event]
    [event]
	name=attacker hits,defender hits
	[filter]
	    type=bkGhost
	[/filter]
	[filter_second]
	    id=Aethuc,Mal Korvan
	[/filter_second]
	{RANDOM 0..2}
	[if]
	    [variable]
		name=random
		equals=2
	    [/variable]
	    [then]
		[message]
		    speaker=$second_unit.id
		    message= _ "No! You... cannot kill me!"
		[/message]
		[if]
		    [variable]
			name=second_unit.id
			equals="Mal Korvan"
		    [/variable]
		    [then]
			[message]
			    speaker=Rheoran
			    message= _ "He speaks!"
			[/message]
			[message]
			    speaker=Rheoran
			    message= _ "Nevermind."
			[/message]
			[if]
			    [variable]
				name=side2.team_name
				equals="good"
			    [/variable]
			    [then]
				[kill]
				id=$second_unit.id
				animate=yes
				fire_event=no
				[/kill]
				[endlevel]
				    result=defeat
				[/endlevel]
			    [/then]
			    [else]
				[message]
				    speaker=Aethuc
				    message= _ "Without their master to control them, the undead are vanquished!"
				[/message]
				[message]
				    speaker=Rheoran
				    message= _ "I think not. A year ago, I was confronted with one of these undead leaders... it was a lich."
				[/message]
				[message]
				    speaker=Aethuc
				    message= _ "A lich? In these parts? We believed that they have all been vanquished! This is troubling."
				[/message]
				[message]
				    speaker=Aethuc
				    message= _ "We shall go together to meet my comrades. I don't think it is safe for you to go alone after all this."
				[/message]
				[kill]
				id=$second_unit.id
				animate=yes
				fire_event=yes
				[/kill]
			    [/else]
			[/if]	
		    [/then]
		    [else]
			{NARRATOR_MESSAGE (_"We shall see about that.")}
			[if]
			    [variable]
				name=side3.team_name
				equals="good"
			    [/variable]
			    [then]
				[message]
				    speaker=Rheoran
				    message= _ "Aethuc - no!"
				[/message]
				[message]
				    speaker=Aethuc
				    message= _ "The light... shall not be vanquished!"
				[/message]
				[kill]
				id=$second_unit.id
				animate=yes
				fire_event=no
				[/kill]
				[endlevel]
				    result=defeat
				[/endlevel]
			    [/then]
			    [else]
				[kill]
				id=$second_unit.id
				animate=yes
				fire_event=yes
				[/kill]
				{NARRATOR_MESSAGE (_"Now we shall go together to meet my comrades. I think that after this pitiful resistance that you may have to be guarded more carefully.")}
			    [/else]
			[/if]
		    [/else]
		[/if]
	    [/then]
	[/if]
    [/event]
    [event]
	name=victory
	{CLEAR_VARIABLE outlaws,side2,side3,seen,turn_count_start,run_start,move_to,outlaws_bad,ghost1,ghost2,leader2,leader3,unit_att,choice}
	{MODIFY_UNIT (id=Rheoran) moves 6}
	{MODIFY_UNIT (id=Rheoran) max_moves 6}
	{MODIFY_UNIT (id=Hulk) moves 5}
	{MODIFY_UNIT (id=Hulk) max_moves 5}
	{MODIFY_UNIT (id=Rheoran) variables.running_undead no}
	{MODIFY_UNIT (id=Rheoran) variables.running_revivers no}
	{MODIFY_UNIT (id=Hulk) variables.running_undead no}
	{MODIFY_UNIT (id=Hulk) variables.running_revivers no}
	[kill]
	    id=Ghost1
	    animate=no
	    fire_event=no
	[/kill]
	[kill]
	    id=Ghost2
	    animate=no
	    fire_event=no
	[/kill]
    [/event]
    [event]
	name=attacker hits,defender hits
	[filter]
	    [not]
		type=bkGhost
	    [/not]
	[/filter]
	[filter_second]
	    id=Mal Korvan,Aethuc
	[/filter_second]
	[message]
	    speaker=$second_unit.id
	    message= _ "You're a fool to think that you can destroy me."
	[/message]
	{FULL_HEAL id=$second_unit.id}
    [/event]
    [event]
	name=attacker hits,defender hits
	first_time_only=no
	[filter]
	    [not]
		type=bkGhost
	    [/not]
	[/filter]
	[filter_second]
	    id=Mal Korvan,Aethuc
	[/filter_second]
	{FULL_HEAL id=$second_unit.id}
    [/event]
    [event]
	name=die
	[filter]
	    id=Mal Korvan
	[/filter]
	[endlevel]
	    result=victory
	    next_scenario=13b_Cleansing
	[/endlevel]
    [/event]
    [event]
	name=die
	[filter]
	    id=Aethuc
	[/filter]
	[endlevel]
	    result=victory
	    next_scenario=13a_Second_Thoughts
	[/endlevel]
    [/event]
    #undef SPAWN_GHOSTS
[/scenario]